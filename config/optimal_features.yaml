version: '2.0'
type: institutional
created_at: '2025-12-13T00:00:00'
description: |
  Institutional-Grade Feature Set based on AFML (Advances in Financial Machine Learning)

  This configuration replaces "retail" indicators (raw RSI, MACD) with statistically
  rigorous features that improve signal-to-noise ratio:

  1. FRACTIONAL DIFFERENTIATION: Achieves stationarity while preserving memory
  2. MICROSTRUCTURE FEATURES: Captures liquidity and informed trading
  3. REGIME DETECTION: Adapts to market conditions
  4. CLUSTERED SELECTION: Removes redundant features

  Usage in training:
    from src.features.institutional import InstitutionalFeatureEngineer
    engineer = InstitutionalFeatureEngineer()
    features = engineer.build_features(ohlcv_df)

selection_summary:
  total_features: 45
  n_clusters: 35
  feature_categories:
    fracdiff: 5
    microstructure: 12
    regime: 10
    returns: 8
    volatility: 10

# Optimal fractional differentiation d values
# These should be re-computed for each asset using:
#   python scripts/optimize_features.py --fracdiff-search --symbol AAPL
optimal_fracdiff_d:
  close: 0.45
  log_volume: 0.35

feature_categories:
  # Fractional Differentiation Features
  # These preserve memory while achieving stationarity
  fracdiff:
    - close_ffd              # FFD-transformed close price
    - close_ffd_d            # Optimal d value used
    - volume_ffd             # FFD-transformed log volume
    - ffd_zscore             # Z-score of FFD close
    - ffd_momentum           # FFD momentum (deviation from mean)

  # Microstructure Features
  # Capture liquidity, order flow, and informed trading
  microstructure:
    - micro_vpin             # Volume-Synchronized Probability of Informed Trading
    - micro_vpin_zscore      # VPIN z-score (toxicity detector)
    - micro_vpin_regime      # Binary toxic flow indicator
    - micro_kyle_lambda      # Kyle's price impact coefficient
    - micro_kyle_lambda_pct  # Kyle's Lambda percentile
    - micro_amihud_illiq     # Amihud illiquidity measure
    - micro_ofi              # Order Flow Imbalance [-1, 1]
    - micro_ofi_momentum     # OFI deviation from mean
    - micro_ofi_persistence  # Persistence of order flow direction
    - micro_effective_spread # Estimated bid-ask spread
    - micro_spread_regime    # Wide spread indicator
    - micro_score            # Combined microstructure quality score

  # Regime Features
  # Model adapts behavior based on market regime
  regime:
    - regime_hmm_state       # HMM hidden state (0, 1, 2)
    - regime_hmm_confidence  # Confidence in regime classification
    - regime_hmm_regime      # Categorical: bull/bear/neutral
    - regime_regime_change   # Binary: regime just changed
    - regime_regime_duration # Bars since last regime change
    - regime_vol_percentile  # Rolling volatility percentile
    - regime_vol_regime_num  # Numeric volatility regime
    - regime_trend_regime_num # Numeric trend regime
    - regime_regime_score    # Combined regime favorability [-1, 1]
    - regime_prob_bull       # P(bull state) from HMM

  # Return Features (stationary by construction)
  returns:
    - return_1               # 1-bar return
    - return_5               # 5-bar return
    - return_10              # 10-bar return
    - return_20              # 20-bar return
    - return_60              # 60-bar return
    - log_return_5           # Log return (5-bar)
    - return_momentum        # Short vs long return difference
    - return_accel           # Return acceleration

  # Volatility Features
  volatility:
    - vol_5                  # 5-bar realized volatility
    - vol_10                 # 10-bar realized volatility
    - vol_20                 # 20-bar realized volatility
    - vol_60                 # 60-bar realized volatility
    - vol_ratio              # Short/long volatility ratio
    - vol_parkinson          # Parkinson high-low volatility
    - vol_gk                 # Garman-Klass volatility

# All features in flat list for easy import
optimal_features:
  # Fractional Differentiation
  - close_ffd
  - close_ffd_d
  - volume_ffd
  - ffd_zscore
  - ffd_momentum
  # Microstructure
  - micro_vpin
  - micro_vpin_zscore
  - micro_vpin_regime
  - micro_kyle_lambda
  - micro_kyle_lambda_pct
  - micro_amihud_illiq
  - micro_ofi
  - micro_ofi_momentum
  - micro_ofi_persistence
  - micro_effective_spread
  - micro_spread_regime
  - micro_score
  # Regime
  - regime_hmm_state
  - regime_hmm_confidence
  - regime_hmm_regime
  - regime_regime_change
  - regime_regime_duration
  - regime_vol_percentile
  - regime_vol_regime_num
  - regime_trend_regime_num
  - regime_regime_score
  - regime_prob_bull
  # Returns
  - return_1
  - return_5
  - return_10
  - return_20
  - return_60
  - log_return_5
  - return_momentum
  - return_accel
  # Volatility
  - vol_5
  - vol_10
  - vol_20
  - vol_60
  - vol_ratio
  - vol_parkinson
  - vol_gk

# Features to EXCLUDE (retail indicators that add noise)
removed_features:
  # Raw technical indicators (non-stationary)
  - rsi_7
  - rsi_14
  - rsi_21
  - macd
  - macd_signal
  - macd_hist
  - stoch_k_14
  - stoch_d_14
  - williams_r_14
  - williams_r_21
  - cci_14
  - cci_20
  # Raw moving averages (non-stationary)
  - sma_5
  - sma_10
  - sma_20
  - sma_50
  - sma_100
  - sma_200
  - ema_5
  - ema_10
  - ema_20
  - ema_50
  - ema_100
  - ema_200
  # Raw Bollinger Bands (non-stationary)
  - bb_upper_10
  - bb_upper_20
  - bb_lower_10
  - bb_lower_20
  # ATR (can be kept for stop-loss but not as ML feature)
  - atr_7
  - atr_14
  - atr_21
  - atr_pct_7
  - atr_pct_14
  - atr_pct_21

# Training configuration aligned with institutional features
training:
  # Meta-labeling configuration
  meta_labeling:
    enabled: true
    primary_signal: trend_following
    pt_sl_ratio: [1.5, 1.0]  # Asymmetric: wider profit target
    max_holding_period: 20
    min_return: 0.001

  # Sample weighting
  sample_weights:
    use_uniqueness: true
    use_time_decay: true
    time_decay_factor: 0.5
    uniqueness_weight: 0.7

  # Cross-validation
  cv:
    method: purged_kfold
    n_splits: 5
    # ISSUE 1.2 FIX: Increased from 0.05 to 0.11 to account for 200-bar
    # feature lookback. With 200-bar lookback features + buffer, minimum
    # embargo should be ~250 bars (~11% for typical 2000-sample dataset)
    embargo_pct: 0.11
    # ISSUE 1.2 FIX: Increased from 10 to 250 to match feature lookback
    purge_gap: 250

  # Ensemble
  ensemble:
    n_estimators: 100
    max_samples: 0.5
    max_features: 0.7
    use_sequential_bootstrap: true
